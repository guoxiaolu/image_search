from elasticsearch import Elasticsearch
import time
from tqdm import tqdm

# start = time.time()
# es = Elasticsearch("0.0.0.0", port=9200)
# es.search(index='image_search',
#     doc_type='image',
#     size=10000)
# # ['hits']['hits']
#
# end_all = time.time()
# print end_all-start
#
# start = time.time()
# page = es.search(
#     index='image_search',
#     doc_type='image',
#     scroll='1m',
#     size=1000)
# end_scroll = time.time()
# print end_scroll-start
#
# sid = page['_scroll_id']
# scroll_size = page['hits']['total']
#
# print 'start scrolling'
# # Start scrolling
# while (scroll_size > 0):
#     start = time.time()
#     page = es.scroll(scroll_id=sid, scroll='1m')
#     end_scroll = time.time()
#     print end_scroll - start
#     # Update the scroll ID
#     sid = page['_scroll_id']
#     # Get the number of results that we returned in the last scroll
#     res = page['hits']['hits']
#     scroll_size = len(res)
#
#
# # es = Elasticsearch("0.0.0.0", port=9200, maxsize=25)
# # start = time.time()
# # res = es.search(index='image_search',
# #     # doc_type='image',
# #     size=1000)
# # end_all = time.time()
# # print end_all-start
#
import requests
import json
from tqdm import tqdm

# body={"terminate_after":20,
#     "query": {
#         "function_score": {
#              "query" : {
#                 "bool" : {
#                   "should" : []
#                }
#            },
#             "script_score": {
#                 "script": {
#                     "inline": "payload_vector_score",
#                     "lang": "native",
#                     "params": {
#                         "field": "signature",
#                         "vector": [0.15191778540611267, 0.9116442203521729, 0.5474895238876343, 0.13752852380275726, 0.3628004789352417, 0.24898211658000946, 0.21913857758045197, 0.7899333238601685, 0.39295831322669983, 0.23070083558559418, 0.5011995434761047, 0.6392593383789062, 0.4865974485874176, 0.4152217209339142, 0.575247049331665, 0.8099488019943237, 0.7730967402458191, 0.5423996448516846, 0.3509787917137146, 0.8308897614479065, 0.3531034290790558, 0.23617903888225555, 0.1256505697965622, 0.19812215864658356, 0.6397538185119629, 0.6503108739852905, 0.7487128973007202, 0.8891299962997437, 0.7213552594184875, 0.6540147066116333, 0.8332844376564026, 0.9569740891456604, 0.8468811511993408, 0.3338959217071533, 0.7223336100578308, 0.11747977882623672, 0.6930133104324341, 0.4283175766468048, 0.7028919458389282, 0.5930078029632568, 0.9480078816413879, 0.4251558780670166, 0.5823050737380981, 0.2714710235595703, 0.8218727707862854, 0.4159943163394928, 0.9704837799072266, 0.9070011973381042, 0.2996218204498291, 0.19074803590774536, 0.1425076425075531, 0.15085890889167786, 0.9404157400131226, 0.9806007146835327, 0.9176903367042542, 0.9805057048797607, 0.6613147258758545, 0.9051029086112976, 0.9437553882598877, 0.9838195443153381, 0.9405015110969543, 0.34374356269836426, 0.35917121171951294, 0.6497191786766052, 0.889195442199707, 0.6785956621170044, 0.8980985283851624, 0.8201801180839539, 0.7367488145828247, 0.15336710214614868, 0.9946491122245789, 0.9199151396751404, 0.8205235004425049, 0.9605493545532227, 0.9933522343635559, 0.9532503485679626, 0.6829608082771301, 0.9678229689598083, 0.9899230003356934, 0.9920967221260071, 0.547877848148346, 0.5245762467384338, 0.33342796564102173, 0.30192381143569946, 0.9464408159255981, 0.24079689383506775, 0.31573179364204407, 0.3677508533000946, 0.5826816558837891, 0.6390873789787292, 0.9432095289230347, 0.12101835012435913, 0.34557923674583435, 0.20101650059223175, 0.9779558777809143, 0.2896634340286255, 0.2510717809200287, 0.18795806169509888, 0.01023867167532444, 0.18434852361679077, 0.4051607549190521, 0.02497958205640316, 0.23321455717086792, 0.09801916778087616, 0.15706570446491241, 0.038276925683021545, 0.13216149806976318, 0.6746559739112854, 0.9995223879814148, 0.7776578068733215, 0.9554954171180725, 0.8964961171150208, 0.981907844543457, 0.9996379017829895, 0.9906386733055115, 0.992621898651123, 0.9182552695274353, 0.9711794257164001, 0.49624335765838623, 0.8594778180122375, 0.8187769055366516, 0.25930148363113403, 0.3660247027873993, 0.6925151944160461, 0.9349228143692017, 0.9964892864227295, 0.9694479703903198, 0.09965379536151886, 0.12724585831165314, 0.2930990159511566, 0.8602678775787354, 0.37969261407852173, 0.47964760661125183, 0.21776822209358215, 0.3435713052749634, 0.5456905364990234, 0.3927910625934601, 0.05604729428887367, 0.09062046557664871, 0.5816646218299866, 0.2807675302028656, 0.1476641148328781, 0.06547488272190094, 0.18639811873435974, 0.22547116875648499, 0.19749297201633453, 0.14556525647640228, 0.11035556346178055, 0.09618285298347473, 0.19200752675533295, 0.13905982673168182, 0.8534901142120361, 0.6710757613182068, 0.6755596995353699, 0.6564404964447021, 0.8394885659217834, 0.5714292526245117, 0.8709163665771484, 0.6936071515083313, 0.6372330188751221, 0.3426402509212494, 0.5103113055229187, 0.5162144303321838, 0.46879178285598755, 0.1205945685505867, 0.16228313744068146, 0.06951034069061279, 0.09799706190824509, 0.4791439175605774, 0.11471385508775711, 0.19585004448890686, 0.8450241684913635, 0.6311105489730835, 0.4906911253929138, 0.26871925592422485, 0.07340414822101593, 0.34182146191596985, 0.2097942978143692, 0.5812199711799622, 0.28994980454444885, 0.11403001099824905, 0.22216790914535522, 0.4620975852012634, 0.3014969229698181, 0.4451988637447357, 0.9158965945243835, 0.7631286978721619, 0.9829236268997192, 0.1906171590089798, 0.26707223057746887, 0.09565749019384384, 0.43350040912628174, 0.5899191498756409, 0.9161401391029358, 0.09464503079652786, 0.6057826280593872, 0.6336296200752258, 0.17907685041427612, 0.55937260389328, 0.4926927983760834, 0.7283310294151306, 0.7376623749732971, 0.553239643573761, 0.6089286208152771, 0.709536075592041, 0.1844114512205124, 0.03637420013546944, 0.32134872674942017, 0.3130267262458801, 0.08977753669023514, 0.04099122807383537, 0.43062931299209595, 0.05681503936648369, 0.5982511043548584, 0.1850643903017044, 0.1320691853761673, 0.17245374619960785, 0.15207508206367493, 0.21062590181827545, 0.39405667781829834, 0.17495153844356537, 0.08547820895910263, 0.12812691926956177, 0.44816678762435913, 0.5219267010688782, 0.11033056676387787, 0.17144425213336945, 0.1144813522696495, 0.10083723813295364, 0.24067948758602142, 0.56238853931427, 0.3198784589767456, 0.44208067655563354, 0.36772263050079346, 0.12988026440143585, 0.3787638247013092, 0.5703316926956177, 0.8117530345916748, 0.2693837285041809, 0.1658855378627777, 0.49047666788101196, 0.24925151467323303, 0.40311503410339355, 0.18569311499595642, 0.11461132764816284, 0.3800888955593109, 0.12766192853450775, 0.06538025289773941, 0.6402621269226074, 0.39364996552467346, 0.49731895327568054, 0.30214807391166687, 0.6065973043441772, 0.840239942073822, 0.7126064896583557, 0.10844119638204575, 0.07589666545391083, 0.24147182703018188, 0.2351243793964386, 0.5548725128173828, 0.1913965791463852, 0.383872389793396, 0.31178125739097595, 0.2812328338623047, 0.4455585777759552, 0.7927451729774475, 0.543234646320343, 0.4637680947780609, 0.29180455207824707, 0.4774205684661865, 0.33280861377716064, 0.5145775079727173, 0.425596684217453, 0.18985353410243988, 0.1869952529668808, 0.2848620116710663, 0.05972321331501007, 0.7656434774398804, 0.5237970352172852, 0.46058642864227295, 0.5203226208686829, 0.7670533657073975, 0.4426751434803009, 0.3468201458454132, 0.6851608157157898, 0.5152941942214966, 0.08233615756034851, 0.20174020528793335, 0.11619041860103607, 0.047028377652168274, 0.23023343086242676, 0.04267604276537895, 0.27672192454338074, 0.18275943398475647, 0.5061794519424438, 0.1109800636768341, 0.1359138786792755, 0.048269543796777725, 0.27621525526046753, 0.5110818147659302, 0.9522981643676758, 0.999830424785614, 0.9597107172012329, 0.981702983379364, 0.9981099367141724, 0.9453883171081543, 0.7583469748497009, 0.9993100762367249, 0.9994494915008545, 0.9999087452888489, 0.9999589920043945, 0.9974220395088196, 0.9957709908485413, 0.8780548572540283, 0.9742883443832397, 0.9940599799156189, 0.9918580651283264, 0.9955201745033264, 0.9978452920913696, 0.9675832986831665, 0.9845004677772522, 0.9715717434883118, 0.9520815014839172, 0.9800218343734741, 0.9866085648536682, 0.9888308644294739, 0.9752400517463684, 0.9448806047439575, 0.9893531203269958, 0.46419915556907654, 0.6433423161506653, 0.703154981136322, 0.40092045068740845, 0.755415141582489, 0.43879061937332153, 0.23282545804977417, 0.4336835741996765, 0.15362554788589478, 0.3882525861263275, 0.1649024933576584, 0.5941494703292847, 0.3665556311607361, 0.08929591625928879, 0.06235697492957115, 0.09776504337787628, 0.18252237141132355, 0.07947982102632523, 0.0468173623085022, 0.47681206464767456, 0.49590447545051575, 0.3998482823371887, 0.11864346265792847, 0.5218944549560547, 0.2864851951599121, 0.025011615827679634, 0.176923930644989, 0.34267014265060425, 0.1560557335615158, 0.5876971483230591, 0.5801554918289185, 0.11779944598674774, 0.30517667531967163, 0.4793335497379303, 0.437140554189682, 0.12411830574274063, 0.20841866731643677, 0.21415995061397552, 0.23171475529670715, 0.22081108391284943, 0.050428349524736404, 0.21188412606716156, 0.033188626170158386, 0.13310223817825317, 0.13181136548519135, 0.22173497080802917, 0.15141752362251282, 0.06327100843191147, 0.36524927616119385, 0.19529828429222107, 0.2813345193862915, 0.6009032726287842, 0.07052895426750183, 0.5329710841178894, 0.31992051005363464, 0.12599553167819977, 0.18589860200881958, 0.04737479239702225, 0.4245925545692444, 0.10939670354127884, 0.2419249564409256, 0.8713672161102295, 0.14393405616283417, 0.4433891475200653, 0.96307772397995, 0.04148842394351959, 0.3139669597148895, 0.9844404458999634, 0.805777370929718, 0.9138644337654114, 0.5037304759025574, 0.5054556727409363, 0.9289805889129639, 0.7718260884284973, 0.02016526460647583, 0.047829631716012955, 0.2647997736930847, 0.20557008683681488, 0.04459724947810173, 0.03113139420747757, 0.851902425289154, 0.5842487812042236, 0.1617724448442459, 0.40157052874565125, 0.0704311802983284, 0.5393735766410828, 0.4200139343738556, 0.3808736205101013, 0.937757670879364, 0.9958635568618774, 0.531164824962616, 0.20568887889385223, 0.9371601939201355, 0.4819500148296356, 0.09027574956417084, 0.06575928628444672, 0.2749389410018921, 0.455197274684906, 0.2584576904773712, 0.8699954152107239, 0.6027498245239258, 0.07238919287919998, 0.5158405900001526, 0.5579971075057983, 0.5510138869285583, 0.8877435922622681, 0.9598666429519653, 0.2639347314834595, 0.33233436942100525, 0.49142906069755554, 0.05754312872886658, 0.34378260374069214, 0.4837842881679535, 0.20379753410816193, 0.08348948508501053, 0.4050386846065521, 0.5938918590545654, 0.9834462404251099, 0.6509795784950256, 0.4967021346092224, 0.016141850501298904, 0.48643258213996887, 0.3294069766998291, 0.7601035833358765, 0.40945732593536377, 0.12362217158079147, 0.4643612504005432, 0.5442805886268616, 0.7336815595626831, 0.05488496646285057, 0.6136088967323303, 0.1309853196144104, 0.27740904688835144, 0.576088547706604, 0.8554165363311768, 0.4222700297832489, 0.007950629107654095, 0.10259187966585159, 0.11511503159999847, 0.4124159514904022, 0.17934522032737732, 0.9580057263374329, 0.5737987756729126, 0.16145342588424683, 0.2992269694805145, 0.6963388323783875, 0.6526501178741455, 0.26940208673477173, 0.14682704210281372, 0.2916279137134552, 0.7934423685073853, 0.2027101069688797, 0.3754676282405853, 0.16450758278369904, 0.2212248295545578, 0.019166573882102966, 0.5864319801330566, 0.4762912690639496, 0.38934293389320374, 0.9507144093513489, 0.9864559769630432, 0.644658625125885, 0.03911198675632477, 0.31972864270210266, 0.5367329716682434, 0.8061701059341431, 0.1709747612476349, 0.2640586793422699, 0.5333337783813477, 0.3668876886367798, 0.201769158244133, 0.01253494806587696, 0.7519145011901855, 0.3009161949157715, 0.8353087306022644, 0.5938210487365723, 0.5657098889350891, 0.9996182918548584, 0.8432372808456421, 0.5837633013725281, 0.7272542715072632, 0.04961071535944939, 0.34713852405548096, 0.9365800619125366, 0.8338334560394287, 0.21469290554523468, 0.6328635215759277, 0.46119555830955505, 0.15179921686649323, 0.43713876605033875, 0.13683944940567017, 0.5000239014625549, 0.43490082025527954, 0.7512037754058838, 0.33247673511505127, 0.1686941385269165, 0.16398480534553528, 0.2723725438117981, 0.3593961000442505, 0.5900784730911255, 0.18940189480781555, 0.8297251462936401, 0.6067332029342651, 0.2152709811925888, 0.27819523215293884, 0.6057687997817993, 0.2575486898422241, 0.008923162706196308, 0.11437241733074188, 0.41991591453552246, 0.18714527785778046, 0.028768740594387054, 0.42706775665283203, 0.8407853245735168, 0.4547518789768219, 0.16726504266262054, 0.9345406889915466, 0.5177015662193298, 0.03765762969851494, 0.04511512815952301, 0.6728599071502686, 0.11860193312168121, 0.0950457751750946, 0.981033205986023, 0.343751460313797, 0.6757816076278687, 0.28395503759384155, 0.5725541710853577, 0.6989235281944275, 0.8858279585838318, 0.3409101068973541, 0.13145829737186432, 0.07463420182466507, 0.9967909455299377, 0.651531994342804, 0.10707779973745346, 0.0606062151491642, 0.9128877520561218, 0.10827881842851639, 0.18509770929813385, 0.09867580980062485, 0.6233866810798645, 0.12266118079423904, 0.8879917860031128, 0.20768888294696808, 0.9138056635856628, 0.12321358919143677, 0.08978042006492615, 0.6124492883682251, 0.8926656246185303, 0.5334047079086304, 0.9905573725700378, 0.6347299814224243, 0.3408554494380951, 0.01914885640144348, 0.9402871131896973, 0.6973012685775757, 0.03355684503912926, 0.28172874450683594, 0.5622085332870483, 0.5755804181098938, 0.3337768316268921, 0.8709510564804077, 0.259551465511322, 0.40678080916404724, 0.7768468856811523, 0.15547263622283936, 0.07841558009386063, 0.03461562842130661, 0.40412983298301697, 0.9035869836807251, 0.9661595225334167, 0.5360373854637146, 0.13779163360595703, 0.04520266503095627, 0.7868306040763855, 0.38146546483039856, 0.6688207983970642, 0.7436355948448181, 0.5828395485877991, 0.07991861552000046, 0.09823666512966156, 0.49146774411201477, 0.0844087302684784, 0.24598512053489685, 0.9127233028411865, 0.016958944499492645, 0.9976457357406616, 0.8189712762832642, 0.7014502882957458, 0.9202862977981567, 0.6426990032196045, 0.5637222528457642, 0.754494845867157, 0.5263564586639404, 0.2733156383037567, 0.021082429215312004, 0.8116267919540405, 0.2972622215747833, 0.20995491743087769, 0.8227002024650574, 0.4283231496810913, 0.8000783324241638, 0.5440940856933594, 0.9326164722442627, 0.012546113692224026, 0.33428189158439636, 0.5664342045783997, 0.7375732064247131, 0.7649790048599243, 0.36889493465423584, 0.04059183970093727, 0.734085202217102, 0.7201017737388611, 0.8341315984725952, 0.9576819539070129, 0.9138465523719788, 0.7224462032318115, 0.5618715286254883, 0.16557677090168, 0.0388021320104599, 0.867959201335907, 0.08934658765792847, 0.1529444307088852, 0.2536560893058777, 0.10934428870677948, 0.32698461413383484, 0.06689335405826569, 0.1518343687057495, 0.7525765895843506, 0.8285977244377136, 0.0556655190885067, 0.11864333599805832, 0.057754937559366226, 0.10691417008638382, 0.8949646353721619, 0.36558839678764343, 0.9352059960365295, 0.2879672646522522, 0.14985057711601257, 0.60125732421875, 0.6819726824760437, 0.496076762676239, 0.22435635328292847, 0.7593543529510498, 0.3914382755756378, 0.009472635574638844, 0.18004871904850006, 0.9779067039489746, 0.19744394719600677, 0.8985143899917603, 0.6276784539222717, 0.7406306862831116, 0.18928219377994537, 0.720745861530304, 0.164458230137825, 0.24200481176376343, 0.04862319678068161, 0.8231619596481323, 0.6312408447265625, 0.5672454237937927, 0.09674522280693054, 0.32494914531707764, 0.27185702323913574, 0.20193074643611908, 0.6132310032844543, 0.7070724368095398, 0.972899317741394, 0.8170692324638367, 0.47863510251045227, 0.3363444209098816, 0.6467490196228027, 0.8471458554267883, 0.2351377010345459, 0.8421360850334167, 0.376933217048645, 0.03588217869400978, 0.15306919813156128, 0.18952572345733643, 0.19343288242816925, 0.7210031747817993, 0.5409099459648132, 0.9614444375038147, 0.6064307689666748, 0.22239071130752563, 0.5586482286453247, 0.023900145664811134, 0.9551267027854919, 0.13739901781082153, 0.16846735775470734, 0.9544195532798767, 0.7943339943885803, 0.780406653881073, 0.3858433663845062, 0.9950774312019348, 0.03504663705825806, 0.8506028056144714, 0.09998461604118347, 0.5145128965377808, 0.5750706791877747, 0.6923030018806458, 0.32181215286254883, 0.4742385745048523, 0.4066218137741089, 0.42029857635498047, 0.0178432147949934, 0.8399109244346619, 0.6219996213912964, 0.3570164442062378, 0.9694396257400513, 0.2889873683452606, 0.7838160395622253, 0.25284144282341003, 0.17507882416248322, 0.10225733369588852, 0.10866671800613403, 0.7884036302566528, 0.03197050467133522, 0.056715045124292374, 0.6218122243881226, 0.9792004823684692, 0.8005502223968506, 0.16159886121749878, 0.10784463584423065, 0.9664881229400635, 0.3515041768550873, 0.25785356760025024, 0.6173897981643677, 0.031774166971445084, 0.7963095903396606, 0.6246333718299866, 0.10635020583868027, 0.24901586771011353, 0.2748074233531952, 0.2642894983291626, 0.37555718421936035, 0.6212751269340515, 0.3007686734199524, 0.9361688494682312, 0.02371441386640072, 0.8369314670562744, 0.3868694305419922, 0.3244377374649048, 0.9926879405975342, 0.45618847012519836, 0.48303237557411194, 0.7301414608955383, 0.7758663892745972, 0.3674681782722473, 0.03865867853164673, 0.1309494972229004, 0.049415625631809235, 0.16732190549373627, 0.6814533472061157, 0.9698984622955322, 0.7950958013534546, 0.6750308275222778, 0.6014849543571472, 0.1594059020280838, 0.37636348605155945, 0.7567704916000366, 0.5770507454872131, 0.38510823249816895, 0.49847811460494995, 0.7278745174407959, 0.9812020659446716, 0.6287332773208618, 0.2415180206298828, 0.2936537563800812, 0.06235216557979584, 0.20325534045696259, 0.21330827474594116, 0.23814180493354797, 0.21603532135486603, 0.04697425663471222, 0.41003599762916565, 0.2933477461338043, 0.798899233341217, 0.19761474430561066, 0.563891589641571, 0.6166127920150757, 0.1066713035106659, 0.6582188010215759, 0.08159743994474411, 0.5921742916107178, 0.10943682491779327, 0.9952442646026611, 0.9239341616630554, 0.36042770743370056, 0.9910299181938171, 0.9444878697395325, 0.06467539072036743, 0.1291036754846573, 0.10153520852327347, 0.966537594795227, 0.8430182337760925, 0.145199716091156, 0.7983297109603882, 0.8615506291389465, 0.8975508809089661, 0.3212665915489197, 0.11797860264778137, 0.5489575862884521, 0.1882801651954651, 0.014652291312813759, 0.7607648968696594, 0.5787367820739746, 0.8457582592964172, 0.8400603532791138, 0.48424744606018066, 0.2050212174654007, 0.7948253154754639, 0.8443359732627869, 0.04117077589035034, 0.4681922197341919, 0.8167378306388855, 0.9066870212554932, 0.37558305263519287, 0.025124231353402138, 0.44855430722236633, 0.9137725830078125, 0.7847093343734741, 0.7429013848304749, 0.6191341280937195, 0.35149478912353516, 0.9625406265258789, 0.9642353653907776, 0.07946190983057022, 0.15206953883171082, 0.7926512360572815, 0.6651535034179688, 0.044902503490448, 0.3420570194721222, 0.8944399952888489, 0.11729772388935089, 0.07335882633924484, 0.1291966736316681, 0.447283536195755, 0.19020935893058777, 0.6498132348060608, 0.6572682857513428, 0.4800757169723511, 0.034723468124866486, 0.7070496678352356, 0.08406781405210495, 0.02965931035578251, 0.8536297082901001, 0.8080823421478271, 0.1512281596660614, 0.3185041546821594, 0.9377736449241638, 0.6589490175247192, 0.43345770239830017, 0.35197800397872925, 0.9534546732902527, 0.8025219440460205, 0.9873571991920471, 0.15060201287269592, 0.5902881622314453, 0.04132571071386337, 0.6581955552101135, 0.08049731701612473, 0.012724247761070728, 0.8595204949378967, 0.33240577578544617, 0.4196125268936157, 0.15180186927318573, 0.791563868522644, 0.45234444737434387, 0.7958259582519531, 0.5270891785621643, 0.08626916259527206, 0.020377494394779205, 0.7214310765266418, 0.9334987998008728, 0.8677130937576294, 0.9608026146888733, 0.9297682046890259, 0.6583214998245239, 0.27472567558288574, 0.2618787884712219, 0.48142969608306885, 0.8620874285697937, 0.8747274875640869, 0.023605776950716972, 0.03570634499192238, 0.16215023398399353, 0.8092846870422363, 0.31588229537010193, 0.5098984241485596, 0.035050369799137115, 0.25510480999946594, 0.09984798729419708, 0.09748320281505585, 0.789675235748291, 0.5733636617660522, 0.5829924941062927, 0.06655695289373398, 0.2559360861778259, 0.6958644986152649, 0.867723822593689, 0.12771296501159668, 0.22360767424106598, 0.6125380992889404, 0.028804242610931396, 0.14321814477443695, 0.1821342557668686, 0.9383493661880493, 0.8362843990325928, 0.5291359424591064, 0.8375446796417236, 0.17498500645160675, 0.6985992193222046, 0.3646090626716614, 0.7886283993721008, 0.9891347289085388, 0.9466103911399841, 0.9997085332870483, 0.9256097078323364, 0.9538009762763977, 0.9471805095672607, 0.9370693564414978, 0.8061962127685547, 0.6384438276290894, 0.9786165356636047, 0.7564202547073364, 0.20916172862052917, 0.29449501633644104, 0.8075327277183533, 0.8123220205307007, 0.4336397051811218, 0.27116549015045166, 0.07091838121414185, 0.14639578759670258, 0.1691335290670395, 0.08948416262865067, 0.06180032715201378, 0.9311607480049133, 0.3564746379852295, 0.9444001913070679, 0.35890114307403564, 0.25268247723579407, 0.9973174929618835, 0.08164485543966293, 0.9043706655502319, 0.06854333728551865, 0.5482272505760193, 0.08096595853567123, 0.131347194314003, 0.4902185797691345, 0.14819133281707764, 0.23865196108818054, 0.13598710298538208, 0.9683266878128052, 0.5914002060890198, 0.79517662525177, 0.9999444484710693, 0.8553330898284912, 0.8899880051612854, 0.8941568732261658, 0.9631970524787903, 0.7221536040306091, 0.7355992197990417, 0.6574193239212036, 0.02939043939113617, 0.7211790680885315, 0.8284753561019897, 0.7108219265937805, 0.1038045734167099, 0.8804908394813538, 0.7753538489341736],
#                         "cosine": True
#                     }
#                 }
#             },
#             "min_score" : 0.00001,
#             "boost_mode":"replace"
#         }
#     }
# }
#
# body["query"]["function_score"]["query"]["bool"]["should"]=[
#     {"multi_match": {
#         "query": 738,
#         "fields": ["top_1", "top_2", "top_3"]
#     }},
#     {"multi_match": {
#         "query": 967,
#         "fields": ["top_1", "top_2", "top_3"]
#     }},
#     {"multi_match": {
#         "query": 73,
#         "fields": ["top_1", "top_2", "top_3"]
#     }}
#                   ]
# start = time.time()
# tmp = json.dumps(body)
# res = requests.post('http://localhost:9200/image_search_tmp/image/_search',data=tmp)
# end_all = time.time()
# print res.text
# print end_all-start
#
#
#
# start = time.time()
# es = Elasticsearch("0.0.0.0", port=9200)
# res = es.search(index='image_search_tmp',
#     doc_type='image',
#     size=20,
#     body=body,
#     _source_exclude=['signature', 'timestamp', 'thumbnail'])
# # ['hits']['hits']
#
# end_all = time.time()
# print res
# print end_all-start


# es = Elasticsearch("0.0.0.0", port=9200)
# res = es.search(index='image_search0',
#     doc_type='image',
#     size=1)['hits']['hits'][0]['_source']
#
# print res
# #
# for i in tqdm(range(10)):
#     es.index(index='image_search_tmp', doc_type='image', body=res)


# import json
#
# f = open('es_image_search.json', 'r')
# for line in f.readlines():
#     data = json.loads(line)['_source']
#     message = {}
#     message['id'] = data['msg_id']
#     message_pic = {}
#     message_pic['url'] = data['path']
#     message_pic['id'] = data['pic_id']
#     message['pics'] = [message_pic]
#     print message
#
# f.close()


# from elasticsearch import Elasticsearch
# es = Elasticsearch("0.0.0.0", port=9200)
# # delete index if exists
# if es.indices.exists("image_search_tmp"):
#     es.indices.delete(index="image_search_tmp")
# # index settings
# settings = {
#     "settings" : {
#         "analysis": {
#                 "analyzer": {
#                    "payload_analyzer": {
#                       "type": "custom",
#                       "tokenizer":"whitespace",
#                       "filter":"delimited_payload_filter"
#                     }
#           }
#         }
#      },
#      "mappings": {
#         "image" : {
#           "properties" : {
#               "signature": {
#                               "type": "text",
#                               "term_vector": "with_positions_offsets_payloads",
#                               "analyzer" : "payload_analyzer"
#                        }
#           }
#       }
#      }
# }
# # create index
# es.indices.create(index="image_search_tmp", body=settings)



es = Elasticsearch("0.0.0.0", port=9200)

# start = time.time()
# page = es.search(
#     index='test',
#     doc_type='movies',
#     scroll='1m',
#     size=1)
# end_scroll = time.time()
# print end_scroll-start
#
# sid = page['_scroll_id']
# scroll_size = page['hits']['total']
# res = page['hits']['hits']

# sid = 'DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAABRFk1sWm5FbEo1U3pxejkwX0gtTGFsdXcAAAAAAAAAUhZNbFpuRWxKNVN6cXo5MF9ILUxhbHV3AAAAAAAAAFMWTWxabkVsSjVTenF6OTBfSC1MYWx1dwAAAAAAAABUFk1sWm5FbEo1U3pxejkwX0gtTGFsdXcAAAAAAAAAVRZNbFpuRWxKNVN6cXo5MF9ILUxhbHV3'
scroll_size=1
print 'start scrolling'
# Start scrolling
while (scroll_size > 0):
    start = time.time()
    page = es.scroll(scroll_id=sid, scroll='1m')
    end_scroll = time.time()
    print end_scroll - start
    # Update the scroll ID
    sid = page['_scroll_id']
    # Get the number of results that we returned in the last scroll
    res = page['hits']['hits']
    scroll_size = len(res)
    print sid, res